<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebApp Test</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <h1>TG WebApp API test</h1>
    <pre id="loadResult"></pre>
    <button id="share1">share1</button>
    <a onclick="navigate('/page2', 'page2')">Navigate 2</a>
    <a onclick="navigate('/page3', 'page3')">Navigate 3</a>
    <p id="content">index</p>
    <pre id="debug"></pre>

    <script src="https://daccess1.github.io/scripts/index.js?v=2"></script>
    <script type="text/javascript">
        let _wa;
        let navigations = [{
            url: '/',
            state: 'index'
        }];

        window.addEventListener('load', () => {
            _wa = window.Telegram.WebApp;
            _wa.expand();
            document.getElementById('loadResult').innerHTML = JSON.stringify(getUserData());

            _wa.BackButton.onClick(() => {
                const prevPage = navigations[navigations.length - 2];
                document.getElementById('content').innerHTML = prevPage.state;
                if (navigations.length == 1) {
                    _wa.BackButton.hide();
                } else {
                    navigations.pop();
                }
                document.getElementById('debug').innerHTML = JSON.stringify(navigations);
            });
        });

        document.getElementById('share1').addEventListener('click', (e) => {
            window.Telegram.WebView.postEvent(
                "web_app_open_tg_link",
                () => {
                    console.log('postEvent callback')
                },
                {
                    path_full: "/share/url?text=Share"
                }
            );
        });

        function getUserData() {
            const decoded = decodeURI(_wa.initData);
            return decoded;
        }

        function navigate(url, state) {
            const prevPage = navigations[navigations.length - 1];

            if (url === prevPage.url) {
                return;
            }

            document.getElementById('content').innerHTML = state;
            navigations.push({
                url: url,
                state: state
            });
            _wa.BackButton.show();
            document.getElementById('debug').innerHTML = JSON.stringify(navigations);
        }
    </script>
</body>
</html>